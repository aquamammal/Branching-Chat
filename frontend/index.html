<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Branching Chat – Columns by Depth</title>

  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color-scheme: dark;
    }

    body {
      margin: 0;
      padding: 0;
      background: #050505;
      color: #eee;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    /* ---------------- HEADER ---------------- */
    header {
      padding: 10px 16px;
      background: #080808;
      border-bottom: 1px solid #222;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    header h1 {
      font-size: 16px;
      margin: 0;
      font-weight: 500;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    header button,
    header select,
    header input[type="range"] {
      border-radius: 999px;
      border: 1px solid #444;
      background: #151515;
      color: #eee;
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer;
    }

    header button:hover {
      background: #222;
    }

    .width-label {
      font-size: 11px;
      opacity: 0.8;
    }

    #width-slider {
      cursor: pointer;
    }

    /* ---------------- MAIN THREAD AREA ---------------- */
    #thread-container {
      position: relative;
      flex: 1;
      overflow-x: auto;
      overflow-y: auto;
      padding: 80px 16px 80px 16px;
      scroll-behavior: smooth;
      background: #050505;
    }

    /* ---------------- THREAD ---------------- */
    .thread {
      position: absolute;
      width: 340px;
      display: flex;
      flex-direction: column;
      background: #101010;
      border-radius: 10px;
      border: 1px solid #333;
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.4);
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
      z-index: 2;
    }

    .thread.active {
      border-color: #4ade80;
      box-shadow: 0 0 18px rgba(74, 222, 128, 0.45);
    }

    .thread-header {
      padding: 6px 10px;
      border-bottom: 1px solid #222;
      font-size: 11px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #151515;
      border-radius: 10px 10px 0 0;
      cursor: move;
      gap: 6px;
    }

    .thread-title {
      font-weight: 500;
      max-width: 210px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .thread-body {
      padding: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      overflow: visible;
    }

    .thread-footer {
      padding: 8px;
      border-top: 1px solid #222;
      display: flex;
      gap: 6px;
      background: #0b0b0b;
      border-radius: 0 0 10px 10px;
    }

    /* ---------------- MESSAGES ---------------- */
    .msg {
      padding: 6px 8px;
      border-radius: 8px;
      font-size: 13px;
      max-width: 100%;
    }

    .msg.user { background: #24496e; align-self: flex-end; }
    .msg.assistant { background: #262626; align-self: flex-start; }
    .msg.system { background: #111; opacity: 0.9; font-size: 11px; align-self: center; }

    .msg-text p { margin: 0 0 0.4rem 0; }
    .msg-text ul, .msg-text ol {
      margin: 0.4rem 0 0.4rem 1.2rem;
    }

    .msg-text code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas;
      background: rgba(0,0,0,0.35);
      padding: 0.15em 0.3em;
      border-radius: 4px;
    }

    .msg-text pre {
      padding: 0.75rem;
      background: #050505;
      border-radius: 6px;
      overflow-x: auto;
      border: 1px solid #333;
    }

    .branch-highlight {
      background: #2a7c52;
      padding: 0 2px;
      border-radius: 2px;
      cursor: pointer;
    }

    /* ---------------- INPUT ---------------- */
    input[type="text"] {
      flex: 1;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #333;
      background: #050505;
      color: #eee;
      font-size: 13px;
    }
    input[type="text"]:focus {
      outline: none;
      border-color: #555;
    }

    /* ---------------- HIGHLIGHT BRANCH BUTTON ---------------- */
    #selection-branch-btn {
      position: absolute;
      z-index: 9999;
      padding: 4px 8px;
      font-size: 11px;
      border-radius: 999px;
      border: 1px solid #555;
      background: #111;
      color: #eee;
      cursor: pointer;
      display: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.6);
    }

    /* ---------------- SVG CONNECTION LINES ---------------- */
    #connection-layer {
      position: absolute;
      inset: 0;
      pointer-events: none;
      overflow: visible;
      z-index: 0;
    }

    .thread-connection {
      fill: none;
      stroke: #4ade80;
      stroke-width: 1.6;
      opacity: 0.7;
    }
  </style>

  <!-- Markdown renderer -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
  <header>
    <h1>Branching Chat (Columns by Depth)</h1>
    <div class="header-right">
      <span class="width-label">Width</span>
      <input id="width-slider" type="range" min="260" max="520" value="340" />
      <button id="refresh-layout-btn">↻ Refresh layout</button>
      <button id="new-root-btn">+ New root conversation</button>
    </div>
  </header>

  <div id="thread-container"></div>

  <!-- Hidden branch-from-selection button -->
  <button id="selection-branch-btn">Branch selection →</button>

  <!-- Main JS entry -->
  <script type="module" src="./main.js"></script>
</body>
</html>
